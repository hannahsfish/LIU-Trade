# 架构审查记录 (2026-02-19)

## 审查背景
以"用 LEI 交易思路在美股赚钱"为目标，对照 LEI 完整框架审视 ARCHITECTURE.md v1。

## 发现的问题

### P1: 技术分析模块缺少关键能力
- `detect_2b_structure` 只返回 bool，缺少抵扣价窗口验证（2B + 抵扣价共振才有效）
- 协率(slope)计算完全缺失——无法判断趋势加速/减速
- 均线密集检测没有区分日线/周线级别
- 均线只设计了通用接口，没有固定 MA20/MA60/EMA120 的明确分工

### P2: 信号生成模块过于简单
- 只有4种信号类型，缺少完整的卖出信号体系（抵扣价反转、协率突变、乖离率极值）
- 没有仓位建议分层：2B结构=轻仓试探 vs 均线密集=重仓确认
- 止损价位计算缺少三种模式：前低/筹码峰下沿/逻辑证伪
- 没有持仓期间的趋势变化预警

### P3: 筹码峰实现不充分
- `calculate_volume_profile` 缺少动态时间范围选取
- 需要支持按趋势段落、震荡区间来确定计算范围，而非固定周期
- 缺少筹码峰与均线的交叉验证

### P4: 缺少"交易计划"概念
- LEI 强调每笔交易必须"三有"（有预期、有底线、有计划）
- 架构中没有 TradePlan 实体
- 用户无法在买入前制定完整的交易计划（预期目标、止损位、盈亏比）

### P5: 数据库设计遗漏
- `signals` 表缺少：止损价、目标价、盈亏比、仓位建议、交易逻辑说明
- `positions` 表缺少：交易计划ID、实际平仓价、盈亏结果
- 缺少 `trade_plans` 表
- 缺少 `alerts` 表（趋势变化预警记录）

### P6: 前端缺少核心交互
- 没有抵扣价画框推演的可视化
- 没有筹码峰 (Volume Profile) 显示
- 没有趋势变化的主动提醒机制
- 没有交易计划的制定/跟踪界面
- 没有"下一步该做什么"的操作引导

### P7: 缺少通知/提醒系统
- 用户需求："趋势变化时提醒我如何操作"
- 架构完全没有通知系统（WebSocket推送、浏览器通知、邮件等）
- 没有定时扫描持仓趋势变化的后台任务

## 修复方向
所有问题在 ARCHITECTURE.md v2 中解决。
